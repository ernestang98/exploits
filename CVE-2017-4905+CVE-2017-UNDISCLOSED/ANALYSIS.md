# Commands

Enabling Page Heap

```
"C:\Program Files (x86)\Windows Kits\8.0\Debuggers\x64\gflags.exe" /p /enable "C:\Program Files (x86)\VMware\VMware Workstation\x64\vmware-vmx.exe"
```

Finding the space to allocate

```
    address 0000000009d9e370 found in
    _HEAP @ 5c60000
              HEAP_ENTRY Size Prev Flags            UserPtr UserSize - state
        0000000009d9e320 0013 0000  [00]   0000000009d9e370    000b8 - (free DelayedFree)
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\Windows\System32\verifier.dll - 
        7ffac13c412f verifier!VerifierDisableFaultInjectionExclusionRange+0x000000000000246f
        7ffacc5c3fa1 ntdll!memset+0x0000000000018161
        7ffacc5b95c9 ntdll!memset+0x000000000000d789
        7ffacc5311fd ntdll!RtlFreeHeap+0x000000000000041d
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\Windows\WinSxS\amd64_microsoft.vc90.crt_1fc8b3b9a1e18e3b_9.0.30729.9279_none_08e667efa83ba076\MSVCR90.dll - 
        5a5acabc MSVCR90!free+0x000000000000001c
        7ff6082d2d37 vmware_vmx!opus_repacketizer_get_nb_frames+0x0000000000002337
        7ff6082cc41d vmware_vmx+0x000000000009c41d
        7ff6082aa52e vmware_vmx+0x000000000007a52e
        7ff6082b3f60 vmware_vmx+0x0000000000083f60
        7ff608299446 vmware_vmx+0x0000000000069446
        7ff6082bbb86 vmware_vmx+0x000000000008bb86
        7ff6082eaf10 vmware_vmx!opus_repacketizer_get_nb_frames+0x000000000001a510
        7ff6082eaf94 vmware_vmx!opus_repacketizer_get_nb_frames+0x000000000001a594
        7ff6085db075 vmware_vmx!opus_repacketizer_get_nb_frames+0x000000000030a675
        7ff6085b8ff5 vmware_vmx!opus_repacketizer_get_nb_frames+0x00000000002e85f5
        7ff6085eb552 vmware_vmx!opus_repacketizer_get_nb_frames+0x000000000031ab52
        7ff6085b9368 vmware_vmx!opus_repacketizer_get_nb_frames+0x00000000002e8968
        7ff60841ff5b vmware_vmx!opus_repacketizer_get_nb_frames+0x000000000014f55b
*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\Windows\System32\KERNEL32.DLL - 
        7ffac9e52774 KERNEL32!BaseThreadInitThunk+0x0000000000000014
        7ffacc570d61 ntdll!RtlUserThreadStart+0x0000000000000021
```

Important Breakpoints

- `vmware_vmx+0xb870f8` (Location of Qword Pointer)

- `poi(vmware_vmx+0xb870f8+0x20)` (Location of Shellcode)

- `vmware_vmx+0x9d042` (UaF)

# References

Pythonizing VMware Backdoor

- https://bbs.kanxue.com/thread-222817-1.htm

- https://realpython.com/build-python-c-extension-module/#packaging-your-python-c-extension-module

- https://www.youtube.com/watch?v=HrEzCI3jIHw

- https://docs.python.org/3/extending/extending.html

- https://docs.python.org/3/extending/newtypes_tutorial.html

- https://www.zerodayinitiative.com/blog/2018/1/19/automating-vmware-rpc-request-sniffing

Other VMware Exploits

- https://github.com/WinMin/awesome-vm-exploit

- https://zhuanlan.zhihu.com/p/27733895?utm_medium=social&utm_source=wechat_timeline&from=timeline&isappinstalled=1

Software

- https://archive.org/details/en_visual_studio_ultimate_2013_x86_dvd_3175319

- https://customerconnect.vmware.com/downloads/details?downloadGroup=PLAYER-1200&productId=522

VMware Source Code

- https://github.com/vmware/open-vm-tools/blob/master/open-vm-tools/lib/message/message.c

Enabling Crash Dump for Windows

- https://www.youtube.com/watch?v=S_YtNj4TdaY

