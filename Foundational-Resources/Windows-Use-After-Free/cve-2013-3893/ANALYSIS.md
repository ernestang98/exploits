# Disassembly

```
    _HEAP @ 14a0000
      HEAP_ENTRY Size Prev Flags    UserPtr UserSize - state
        014a3b58 0011 0000  [00]   014a3b80    0004c - (busy)
        014adde8 0011 0011  [00]   014ade10    0004c - (busy)
        014b30e0 0011 0011  [00]   014b3108    0004c - (busy)
          ? iertutil!Ordinal59+66
        014bb018 0011 0011  [00]   014bb040    0004c - (busy)
        014bdb38 0011 0011  [00]   014bdb60    0004c - (busy)
        014c0878 0011 0011  [00]   014c08a0    0004c - (busy)
        014c3d60 0011 0011  [00]   014c3d88    0004c - (busy)
        014cc2e0 0012 0011  [00]   014cc308    0004c - (busy)
        014d18c0 0011 0012  [00]   014d18e8    0004c - (busy)
        014d71f8 0011 0011  [00]   014d7220    0004c - (busy)
        014e10a8 0011 0011  [00]   014e10d0    0004c - (busy)
        014e71a0 0011 0011  [00]   014e71c8    0004c - (busy)
        014e73b0 0012 0011  [00]   014e73d8    0004c - (busy)
        014eb750 0011 0012  [00]   014eb778    0004c - (busy)
        014ef638 0011 0011  [00]   014ef660    0004c - (busy)
          ? mshtml!Ordinal104+4cdbd
        014fbe08 0011 0011  [00]   014fbe30    0004c - (busy)
        01501510 0011 0011  [00]   01501538    0004c - (free DelayedFree)
        01504c80 0011 0011  [00]   01504ca8    0004c - (free DelayedFree)
        01517360 0012 0011  [00]   01517388    0004c - (free DelayedFree)
        0151ca40 0011 0012  [00]   0151ca68    0004c - (free DelayedFree)
        0151e888 0011 0011  [00]   0151e8b0    0004c - (busy)
          ? mshtml!DllGetClassObject+1cdbf
        0152bec8 0012 0011  [00]   0152bef0    0004c - (free DelayedFree)
        0152da50 0011 0012  [00]   0152da78    0004c - (free DelayedFree)
        0153f928 0011 0011  [00]   0153f950    0004c - (busy)
        015410d0 0011 0011  [00]   015410f8    0004c - (busy)
          ? mshtml!RunHTMLApplication+d76ac
        0154ac30 0011 0011  [00]   0154ac58    0004c - (free DelayedFree)
        0154c970 0011 0011  [00]   0154c998    0004c - (busy)
        01551848 0011 0011  [00]   01551870    0004c - (busy)
        01553098 0012 0011  [00]   015530c0    0004c - (free DelayedFree)
        01555710 0011 0012  [00]   01555738    0004c - (free DelayedFree)
        01555b70 0011 0011  [00]   01555b98    0004c - (busy)
        01557448 0011 0011  [00]   01557470    0004c - (free DelayedFree)
        0155f618 0012 0011  [00]   0155f640    0004c - (free DelayedFree)
        01580df8 0011 0012  [00]   01580e20    0004c - (free DelayedFree)
        01583f68 0011 0011  [00]   01583f90    0004c - (busy)
        0158ed98 0011 0011  [00]   0158edc0    0004c - (free DelayedFree)
        015925d8 0011 0011  [00]   01592600    0004c - (busy)
          ? mshtml!DllGetClassObject+fa4b
        01595a80 0011 0011  [00]   01595aa8    0004c - (free DelayedFree)
        04ae3488 0011 0011  [00]   04ae34b0    0004c - (free DelayedFree)

0:005> r
eax=f0f0f0f0 ebx=01557470 ecx=00000003 edx=00000000 esi=6c00b760 edi=6c0412c0
eip=6c0413f2 esp=0357c828 ebp=0357c840 iopl=0         nv up ei ng nz ac po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010293
mshtml!Ordinal104+0x80e53:
6c0413f2 8b08            mov     ecx,dword ptr [eax]  ds:0023:f0f0f0f0=????????
```

- When we try to exploit the UaF with a single instance of the allocation, we fail

- This is because there are multiple free 0x4c blocks

- Note that for this UaF, we must call document.write. If we attempt to exploit it via the HTML+TIME way, document.write removes the t tags. Hence, we have no choice but to fall back on heap spray